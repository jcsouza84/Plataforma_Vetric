/**
 * Verificar o que realmente vem da API CVE
 */

import axios from 'axios';

async function checkCVEData() {
  try {
    // 1. Login
    console.log('ğŸ”‘ Fazendo login...\n');
    const loginResponse = await axios.post('https://cs.intelbras-cve-pro.com.br/api/v1/login', {
      email: process.env.CVE_USERNAME || 'seu_email',
      password: process.env.CVE_PASSWORD || 'sua_senha'
    });
    
    const token = loginResponse.data.token;
    console.log('âœ… Login OK\n');
    
    // 2. Buscar carregadores
    console.log('ğŸ“Š Buscando carregadores...\n');
    const chargersResponse = await axios.get('https://cs.intelbras-cve-pro.com.br/api/v1/chargepoints', {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Api-Key': process.env.CVE_API_KEY || ''
      }
    });
    
    const chargers = chargersResponse.data.chargePointList || [];
    console.log(`âœ… ${chargers.length} carregadores encontrados\n`);
    
    // 3. Analisar cada carregador
    chargers.forEach((charger: any, index: number) => {
      console.log(`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`);
      console.log(`${index + 1}. ${charger.description || charger.chargeBoxId}`);
      console.log(`   chargeBoxId: ${charger.chargeBoxId}`);
      console.log(`   UUID: ${charger.uuid}`);
      
      const connector = charger.connectors?.[0];
      if (connector) {
        console.log(`   Conector ${connector.connectorId}:`);
        console.log(`     Status: ${connector.lastStatus?.status}`);
        console.log(`     ErrorCode: ${connector.lastStatus?.errorCode}`);
        console.log(`     Timestamp: ${connector.lastStatus?.timeStamp}`);
        
        // VERIFICAR SE TEM IDTAG OU CURRENTUSER
        if (connector.lastStatus?.currentChargingUserName) {
          console.log(`     âœ… currentChargingUserName: ${connector.lastStatus.currentChargingUserName}`);
        }
        if (connector.lastStatus?.idTag) {
          console.log(`     âœ… idTag: ${connector.lastStatus.idTag}`);
        }
        if (connector.idTag) {
          console.log(`     âœ… idTag (conector): ${connector.idTag}`);
        }
        
        // Mostrar objeto completo se tiver algo interessante
        if (connector.lastStatus?.status === 'Charging' || 
            connector.lastStatus?.status === 'Occupied') {
          console.log(`\n     ğŸ“‹ lastStatus completo:`);
          console.log(JSON.stringify(connector.lastStatus, null, 6));
        }
      }
      console.log('');
    });
    
  } catch (error: any) {
    console.error('âŒ Erro:', error.response?.data || error.message);
  }
}

checkCVEData();

